<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Maker</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007bff">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            flex-direction: column;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            width: 350px;
            max-width: 90%;
        }
        h2 { color: #333; margin-bottom: 20px; }
        input {
            width: 100%; padding: 12px; margin-bottom: 15px;
            border: 2px solid #ddd; border-radius: 8px;
            box-sizing: border-box; font-size: 16px;
        }
        button {
            background-color: #007bff; color: white; border: none;
            padding: 12px 24px; border-radius: 8px; cursor: pointer;
            font-size: 16px; width: 100%; margin-bottom: 10px;
        }
        button:hover { background-color: #0056b3; }
        
        /* ‡∏õ‡∏∏‡πà‡∏° Install ‡∏à‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
        #installBtn {
            background-color: #28a745;
            display: none; 
        }
        #installBtn:hover { background-color: #218838; }

        #qrcode { margin-top: 25px; display: flex; justify-content: center; }
        #qrcode img { border: 5px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

    <div class="container">
        <h2>‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code</h2>
        
        <button id="installBtn">üì≤ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ</button>

        <input type="text" id="text-input" placeholder="‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏´‡∏£‡∏∑‡∏≠ ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà" />
        <button onclick="generateQR()">‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code</button>

        <div id="qrcode"></div>
    </div>

    <script>
        // 1. ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code
        var qrcode = new QRCode(document.getElementById("qrcode"), {
            width: 200, height: 200,
            colorDark : "#000000", colorLight : "#ffffff",
            correctLevel : QRCode.CorrectLevel.H
        });

        function generateQR() {
            var inputData = document.getElementById("text-input").value;
            if (!inputData) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö"); return; }
            qrcode.clear();
            qrcode.makeCode(inputData);
        }
        qrcode.makeCode("https://google.com");

        // 2. ‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ PWA ‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏° Install
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
            .then(() => console.log("Service Worker Registered"));
        }

        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');

        // ‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö Event ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Browser ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á
        window.addEventListener('beforeinstallprompt', (e) => {
            // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏ñ‡∏ö Install ‡πÄ‡∏î‡πâ‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÄ‡∏≠‡∏á
            e.preventDefault();
            // ‡πÄ‡∏Å‡πá‡∏ö event ‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°
            deferredPrompt = e;
            // ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏° Install ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤
            installBtn.style.display = 'block';
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                // ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏ß‡πå Prompt ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á
                deferredPrompt.prompt();
                // ‡∏£‡∏≠‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏´‡∏°
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response: ${outcome}`);
                // ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏¥‡πâ‡∏á‡πÑ‡∏õ
                deferredPrompt = null;
                // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏î
                installBtn.style.display = 'none';
            }
        });
    </script>

</body>
</html>
